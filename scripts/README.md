# How this documentation project is set up

## Project Structure

In the Freon-documentation project you can find the following folders. 

- The content of all code examples is in the folder '**code-examples**'. The format of these examples is valid input for Freon.

- The '**docs**' folder contains the files generated by SvelteKit. These are the files that should actually be served on [www.freon4dsl.dev](http://www.freon4dsl.dev).

- The content of the documentation is in folder **'docu-content**'. These are in markdown format, and contain references to other markdown files, as well as references to the code examples from the folder 'code-examples'. The names of the folders contain a number to indicate the position of the content within the navigation menus.

- The '**notes**' folder contains a number of files that contains remarks and information for internal use.

- All scripts used during the generation are in the folder '**scripts**'. These are all TypeScript or Javascript files. More information can be found in section '[The Generation Process](#the-generation-process)'.

- The folder '**src**' contains the files needed for SvelteKit, the lib and routes folder. Note that the files directly under the routes folder are not generated. They should always be preserved.

- In the folder '**static**' the images and .css files for the website are kept.

## The Generation Process

The creation of the website is done using the command

`npm run buildSite`

This command switches to the scripts folder and let runs the same command from the **scripts/package.json**. After this we switch back to main package.json and use the 'format' command to make everything prettier.

### Steps in the Generation Process

1. The first step of generating the documentation website is to use Freon for generating the examples needed in the web pages.

2. The second step of generating the documentation website is to use 'embedme' to embed all example code within the markdown files. This tool needs to run before anything else is done with the markdown.
Note that this tools needs all line separators in CRLF (Windows) format. You can use the Webstorm command 'File/File Properties/Line Separators' to change them if needed.

3. Next, the references to other markdown files in the markdown files are checked to see whether they all refer to a valid page. If there any invalid links the generation will halt. Errors and warnings will be logged in '/srcipts/Link_Check.txt'.  (LinkChecker.ts)

4. With the help of 'mdsvex' and the script in 'remarkExtractHeaders.js' the following is done. (Md2Svelte.ts) 
   
   1. All H1 and H2 headers get an extra property 'visible[index]', where index is the number of the header within the document. 
   
   2. Each header gets an id, based on its text and the index, which can be used to refer to using a href.
   
   3. A script part is added to the resulting Svelte file, containing information about the headers, their visibility in the viewport, and their identifiers.
   
   4. All H2 headers are transformed into SectionComponents. Each SectionComponent is bound to a boolean variable that 'knows' whether the header is currently shown in the viewport, using the index from step 1.
   
   5. Three files are generated for each '*+page.md*': '*PageContent.svelte*', which contains the html generated from the markdown input, '+*page.svelte*', which is a sort of layout, but also contains the 'On this page' section, and '*SectionStore.ts*', which holds the store that contains information on whether or not each header is visible in the viewport. These files are placed in the src/routes folder using the path of the original markdown file.

5. Based on the folder structure with the numbers in the folder names, information is generated on the content of the navigation menus.  This information is written to the file  '/src/lib/sidebar/SidebarContent.ts'. (SidebarFiller.ts)

6. For the direct subfolders in the 'docuContent', which represent the categories in the website and do not have a '+page.md' directly placed within,  a redirect script is generated. This script redirects the page to the Intro subfolder. E.g for category 'Documentation' the redirect takes you to '/Documentation/Intro'.

## Testing

1. testing of prefered darkmode In Chrome DevTools, you can emulate prefers-color-scheme and other media features in the rendering tab. <a href="https://developer.chrome.com/docs/devtools/rendering/"> link</a>
   If you prefer Firefox DevTools, it has prefers-color-scheme buttons right in the CSS inspector.
2. testing of different sizes of screens: ctrl-shift-M
